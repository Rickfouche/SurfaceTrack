<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Flux Surface AR</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #ui { position: fixed; bottom: 20px; width: 100%; text-align: center; z-index: 2; }
      #placeBtn { padding: 10px 16px; font-size: 16px; background: #111; color: #fff; border: none; border-radius: 6px; }
      #unsupported { display: none; padding: 10px; background: #fdd; color: #800; text-align: center; }
    </style>
  </head>
  <body>
    <div id="unsupported">AR not supported on this device or browser.</div>
    <div id="ui"><button id="placeBtn">Tap to Place Flux</button></div>

    <a-scene
      renderer="colorManagement: true; physicallyCorrectLights: true"
      xr="optionalFeatures: hit-test, dom-overlay; overlayElement: #ui"
      vr-mode-ui="enabled: false"
      embedded
    >
      <!-- Flux model container -->
      <a-entity id="flux-container" visible="false" scale="0.5 0.5 0.5">
        <a-entity gltf-model="#fluxModel" animation-mixer></a-entity>
      </a-entity>

      <!-- Reticle to show placement surface -->
      <a-ring id="reticle" rotation="-90 0 0" radius-inner="0.04" radius-outer="0.05"
              color="#00ffff" visible="false"></a-ring>

      <a-assets>
        <a-asset-item id="fluxModel" src="./model/Flux.glb"></a-asset-item>
      </a-assets>

      <a-entity light="type: directional; intensity: 1" position="1 2 1"></a-entity>
      <a-entity light="type: ambient; intensity: 0.5"></a-entity>
      <a-entity camera position="0 1.6 0"></a-entity>
    </a-scene>

    <script>
      const scene = document.querySelector('a-scene');
      const reticle = document.getElementById('reticle');
      const flux = document.getElementById('flux-container');
      const placeBtn = document.getElementById('placeBtn');
      const unsupported = document.getElementById('unsupported');

      let xrRefSpace, hitTestSource;

      async function initAR() {
        if (!navigator.xr) {
          unsupported.style.display = 'block';
          return;
        }
        const supported = await navigator.xr.isSessionSupported('immersive-ar');
        if (!supported) {
          unsupported.style.display = 'block';
          return;
        }
      }

      scene.addEventListener('loaded', initAR);

      scene.renderer.xr.addEventListener('sessionstart', async () => {
        const session = scene.renderer.xr.getSession();
        xrRefSpace = await session.requestReferenceSpace('local');
        const viewerSpace = await session.requestReferenceSpace('viewer');
        hitTestSource = await session.requestHitTestSource({ space: viewerSpace });

        scene.renderer.setAnimationLoop((t, frame) => {
          if (!frame) return;
          const hits = frame.getHitTestResults(hitTestSource);
          if (hits.length > 0) {
            const pose = hits[0].getPose(xrRefSpace);
            reticle.object3D.visible = true;
            reticle.object3D.position.copy(pose.transform.position);
            reticle.object3D.quaternion.copy(pose.transform.orientation);
          } else {
            reticle.object3D.visible = false;
          }
        });
      });

      placeBtn.addEventListener('click', () => {
        if (!reticle.object3D.visible) return;
        flux.setAttribute('visible', 'true');
        flux.object3D.position.copy(reticle.object3D.position);
        flux.object3D.quaternion.copy(reticle.object3D.quaternion);
      });
    </script>
  </body>
</html>














